@{
    ViewData["Title"] = "Home Page";

    string responseClass = "language-json"; // Default to JSON
    if (ViewBag.ApiResponse != null && ViewBag.ApiResponse.TrimStart().StartsWith("<"))
    {
        responseClass = "language-xml";
    }
}

<div class="text-center">
    <div class="text-center">
        <div class="alert alert-warning" role="alert">
            Information provided will not always be complete or accurate.
            Responses generated by a GPT 4 LLM AI model hosted on Azure.
        </div>
        
        <div class="alert alert-info" role="info">
            <span><strong>example querys : </strong></span>
            <span>CLEAR</span>, <span>What is the function of UK Parliament</span>, <span>who is Tony Blair</span>, <span>who is 1471</span>, <span>Treaties on fish</span>, <span>Treaties with Spain</span>, <span>Explain {CopyAndPastedApiResult}</span>
        </div>
        
        <div id="response-container">
            @if (ViewBag.ResponseMessage != null)
            {
                <div class="alert alert-success">
                    <strong>AI Response:</strong> @Html.Raw(ViewBag.ResponseMessage)
                </div>
            }
        </div>
        
        <div id="api-response-container">
            @if (ViewBag.ApiResponse != null)
            {
                <div class="alert alert-success">
                    <pre><code id="apiResponseContent" class="@responseClass">@Html.Raw(ViewBag.ApiResponse)</code></pre>
                    <button id="copyButton" class="btn btn-secondary" onclick="copyToClipboard()">Copy to Clipboard</button>
                </div>
                @if (ViewBag.ApiResponseSummary != null)
                {
                    <div class="alert alert-info">
                        @Html.Raw(ViewBag.ApiResponseSummary)
                    </div>
                }
            }
        </div>

        <div id="chat-container" style="margin: 20px;">
            <form id="chatForm" method="post" action="/Home/SendMessageToAI">
                <textarea id="userMessage" name="userMessage" rows="6" style="width: 80%;" placeholder="Ask questions on UK parliament."></textarea>
                <br /><br />
                <button type="submit" class="btn btn-primary">Send Message</button>
            </form>
        </div>

    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        var textarea = document.getElementById("userMessage");
        textarea.focus();

        textarea.addEventListener("keydown", function(event) {
            if (event.key === "Enter" && !event.shiftKey) {
                event.preventDefault();
                document.getElementById("chatForm").submit();
            }
        });
    });

    function copyToClipboard() {
        var copyText = document.getElementById("apiResponseContent").innerText;
        navigator.clipboard.writeText(copyText).then(function () {
            alert("Copied to clipboard!");
        }, function (err) {
            alert("Failed to copy: ", err);
        });
    }
</script>