@{
    ViewData["Title"] = "Home Page";

    string responseClass = "language-json"; // Default to JSON
    if (ViewBag.ApiResponse != null && ViewBag.ApiResponse.TrimStart().StartsWith("<"))
    {
        responseClass = "language-xml";
    }
}

<div class="text-center">
    <div class="text-center">
        <div class="alert alert-warning" role="alert">
            Responses generated by a GPT 4 LLM AI model hosted on Azure.
            AI responses might be inaccurate.
            <p>May generate API calls to public services available on the <a href="https://developer.parliament.uk/" target="_blank">UK Parliament Developer Hub</a></p>
        </div>
        <div class="alert alert-info" role="info">
            <span><strong>Example queries:</strong></span>
            <div id="queryCarousel" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <span>What is the function of UK Parliament</span>
                    </div>
                    <div class="carousel-item">
                        <span>Who is Boris Johnson</span>
                    </div>
                    <div class ="carousel-item">
                        <span>What is happening now in Commons</span>
                    </div>
                    <div class ="carousel-item">
                        <span>What is happening now in Lords</span>
                    </div>
                    <div class="carousel-item">
                        <span>Who is member with id 1471</span>
                    </div>
                    <div class="carousel-item">
                        <span>Treaties on fish</span>
                    </div>
                    <div class="carousel-item">
                        <span>Treaties with Spain</span>
                    </div>
                    <div class="carousel-item">
                        <span>Present all the information in {CopyAndPastedApiResult}</span>
                    </div>
                    <div class="carousel-item">
                        <span>What are registered interests for member 172</span>
                    </div>
                    <div class="carousel-item">
                        <span>Search Erskine May for mace</span>
                    </div>
                    <div class="carousel-item">
                        <span>Search Commons Divisions for refugee</span>
                    </div>
                    <div class="carousel-item">
                        <span>Lords Divisions on refugee</span>
                    </div>
                    <div class="carousel-item">
                        <span>Bills on fish</span>
                    </div>
                    <div class="carousel-item">
                        <span>Committees on women</span>
                    </div>
                    <div class="carousel-item">
                        <span>Early day motions on fish</span>
                    </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#queryCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#queryCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>
        
        <div id="request-container">
            @if (ViewBag.Request != null)
            {
                <div class="alert alert-success">
                    <strong>Your request : </strong> @Html.Raw(ViewBag.Request)
                </div>
            }
        </div>

        <div id="response-container">
            @if (ViewBag.ResponseMessage != null)
            {
                <div class="alert alert-success">
                    <strong>AI Response:</strong> @Html.Raw(ViewBag.ResponseMessage)
                </div>
            }
        </div>

        <div id="api-response-container">
            @if (ViewBag.ApiResponse != null)
            {
                <div class="alert alert-success">
                    <strong>Parliamentary API Response:</strong>
                    <pre><code id="apiResponseContent" class="@responseClass">@Html.Raw(ViewBag.ApiResponse)</code></pre>
                    <button id="copyButton" class="btn btn-secondary" onclick="copyToClipboard()">Copy to Clipboard</button>
                </div>
            }
        </div>

        <div id="chat-container" style="margin: 20px;">
            <form id="chatForm" method="post" action="/Home/SendMessageToAI">
                <textarea id="userMessage" name="userMessage" rows="6" style="width: 80%;" placeholder="Ask questions on UK parliament."></textarea>
                <br/><br/>
                <button type="submit" class="btn btn-primary">Send Message</button>
            </form>
        </div>

    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        var textarea = document.getElementById("userMessage");
        textarea.focus();

        textarea.addEventListener("keydown", function(event) {
            if (event.key === "Enter" && !event.shiftKey) {
                event.preventDefault();
                document.getElementById("chatForm").submit();
            }
        });
    });

    function copyToClipboard() {
        var copyText = document.getElementById("apiResponseContent").innerText;
        navigator.clipboard.writeText(copyText).then(function () {
            alert("Copied to clipboard!");
        }, function (err) {
            alert("Failed to copy: ", err);
        });
    }
</script>